{"ast":null,"code":"import getArguments from 'argsarray';\nimport { Map } from 'pouchdb-collections';\nimport inherits from 'inherits';\nimport immediate from 'immediate';\nimport { createError, BAD_REQUEST, INVALID_ID, MISSING_ID, RESERVED_ID } from 'pouchdb-errors';\nimport EventEmitter from 'events';\nimport { assign } from 'pouchdb-utils';\nimport { v4 } from 'uuid';\nimport { stringMd5 } from 'pouchdb-md5';\nfunction isBinaryObject(object) {\n  return typeof ArrayBuffer !== 'undefined' && object instanceof ArrayBuffer || typeof Blob !== 'undefined' && object instanceof Blob;\n}\nfunction cloneArrayBuffer(buff) {\n  if (typeof buff.slice === 'function') {\n    return buff.slice(0);\n  }\n  // IE10-11 slice() polyfill\n  var target = new ArrayBuffer(buff.byteLength);\n  var targetArray = new Uint8Array(target);\n  var sourceArray = new Uint8Array(buff);\n  targetArray.set(sourceArray);\n  return target;\n}\nfunction cloneBinaryObject(object) {\n  if (object instanceof ArrayBuffer) {\n    return cloneArrayBuffer(object);\n  }\n  var size = object.size;\n  var type = object.type;\n  // Blob\n  if (typeof object.slice === 'function') {\n    return object.slice(0, size, type);\n  }\n  // PhantomJS slice() replacement\n  return object.webkitSlice(0, size, type);\n}\n\n// most of this is borrowed from lodash.isPlainObject:\n// https://github.com/fis-components/lodash.isplainobject/\n// blob/29c358140a74f252aeb08c9eb28bef86f2217d4a/index.js\n\nvar funcToString = Function.prototype.toString;\nvar objectCtorString = funcToString.call(Object);\nfunction isPlainObject(value) {\n  var proto = Object.getPrototypeOf(value);\n  /* istanbul ignore if */\n  if (proto === null) {\n    // not sure when this happens, but I guess it can\n    return true;\n  }\n  var Ctor = proto.constructor;\n  return typeof Ctor == 'function' && Ctor instanceof Ctor && funcToString.call(Ctor) == objectCtorString;\n}\nfunction clone(object) {\n  var newObject;\n  var i;\n  var len;\n  if (!object || typeof object !== 'object') {\n    return object;\n  }\n  if (Array.isArray(object)) {\n    newObject = [];\n    for (i = 0, len = object.length; i < len; i++) {\n      newObject[i] = clone(object[i]);\n    }\n    return newObject;\n  }\n\n  // special case: to avoid inconsistencies between IndexedDB\n  // and other backends, we automatically stringify Dates\n  if (object instanceof Date && isFinite(object)) {\n    return object.toISOString();\n  }\n  if (isBinaryObject(object)) {\n    return cloneBinaryObject(object);\n  }\n  if (!isPlainObject(object)) {\n    return object; // don't clone objects like Workers\n  }\n\n  newObject = {};\n  for (i in object) {\n    /* istanbul ignore else */\n    if (Object.prototype.hasOwnProperty.call(object, i)) {\n      var value = clone(object[i]);\n      if (typeof value !== 'undefined') {\n        newObject[i] = value;\n      }\n    }\n  }\n  return newObject;\n}\nfunction once(fun) {\n  var called = false;\n  return getArguments(function (args) {\n    /* istanbul ignore if */\n    if (called) {\n      // this is a smoke test and should never actually happen\n      throw new Error('once called more than once');\n    } else {\n      called = true;\n      fun.apply(this, args);\n    }\n  });\n}\nfunction toPromise(func) {\n  //create the function we will be returning\n  return getArguments(function (args) {\n    // Clone arguments\n    args = clone(args);\n    var self = this;\n    // if the last argument is a function, assume its a callback\n    var usedCB = typeof args[args.length - 1] === 'function' ? args.pop() : false;\n    var promise = new Promise(function (fulfill, reject) {\n      var resp;\n      try {\n        var callback = once(function (err, mesg) {\n          if (err) {\n            reject(err);\n          } else {\n            fulfill(mesg);\n          }\n        });\n        // create a callback for this invocation\n        // apply the function in the orig context\n        args.push(callback);\n        resp = func.apply(self, args);\n        if (resp && typeof resp.then === 'function') {\n          fulfill(resp);\n        }\n      } catch (e) {\n        reject(e);\n      }\n    });\n    // if there is a callback, call it back\n    if (usedCB) {\n      promise.then(function (result) {\n        usedCB(null, result);\n      }, usedCB);\n    }\n    return promise;\n  });\n}\nfunction logApiCall(self, name, args) {\n  /* istanbul ignore if */\n  if (self.constructor.listeners('debug').length) {\n    var logArgs = ['api', self.name, name];\n    for (var i = 0; i < args.length - 1; i++) {\n      logArgs.push(args[i]);\n    }\n    self.constructor.emit('debug', logArgs);\n\n    // override the callback itself to log the response\n    var origCallback = args[args.length - 1];\n    args[args.length - 1] = function (err, res) {\n      var responseArgs = ['api', self.name, name];\n      responseArgs = responseArgs.concat(err ? ['error', err] : ['success', res]);\n      self.constructor.emit('debug', responseArgs);\n      origCallback(err, res);\n    };\n  }\n}\nfunction adapterFun(name, callback) {\n  return toPromise(getArguments(function (args) {\n    if (this._closed) {\n      return Promise.reject(new Error('database is closed'));\n    }\n    if (this._destroyed) {\n      return Promise.reject(new Error('database is destroyed'));\n    }\n    var self = this;\n    logApiCall(self, name, args);\n    if (!this.taskqueue.isReady) {\n      return new Promise(function (fulfill, reject) {\n        self.taskqueue.addTask(function (failed) {\n          if (failed) {\n            reject(failed);\n          } else {\n            fulfill(self[name].apply(self, args));\n          }\n        });\n      });\n    }\n    return callback.apply(this, args);\n  }));\n}\n\n// like underscore/lodash _.pick()\nfunction pick(obj, arr) {\n  var res = {};\n  for (var i = 0, len = arr.length; i < len; i++) {\n    var prop = arr[i];\n    if (prop in obj) {\n      res[prop] = obj[prop];\n    }\n  }\n  return res;\n}\n\n// Most browsers throttle concurrent requests at 6, so it's silly\n// to shim _bulk_get by trying to launch potentially hundreds of requests\n// and then letting the majority time out. We can handle this ourselves.\nvar MAX_NUM_CONCURRENT_REQUESTS = 6;\nfunction identityFunction(x) {\n  return x;\n}\nfunction formatResultForOpenRevsGet(result) {\n  return [{\n    ok: result\n  }];\n}\n\n// shim for P/CouchDB adapters that don't directly implement _bulk_get\nfunction bulkGet(db, opts, callback) {\n  var requests = opts.docs;\n\n  // consolidate into one request per doc if possible\n  var requestsById = new Map();\n  requests.forEach(function (request) {\n    if (requestsById.has(request.id)) {\n      requestsById.get(request.id).push(request);\n    } else {\n      requestsById.set(request.id, [request]);\n    }\n  });\n  var numDocs = requestsById.size;\n  var numDone = 0;\n  var perDocResults = new Array(numDocs);\n  function collapseResultsAndFinish() {\n    var results = [];\n    perDocResults.forEach(function (res) {\n      res.docs.forEach(function (info) {\n        results.push({\n          id: res.id,\n          docs: [info]\n        });\n      });\n    });\n    callback(null, {\n      results: results\n    });\n  }\n  function checkDone() {\n    if (++numDone === numDocs) {\n      collapseResultsAndFinish();\n    }\n  }\n  function gotResult(docIndex, id, docs) {\n    perDocResults[docIndex] = {\n      id: id,\n      docs: docs\n    };\n    checkDone();\n  }\n  var allRequests = [];\n  requestsById.forEach(function (value, key) {\n    allRequests.push(key);\n  });\n  var i = 0;\n  function nextBatch() {\n    if (i >= allRequests.length) {\n      return;\n    }\n    var upTo = Math.min(i + MAX_NUM_CONCURRENT_REQUESTS, allRequests.length);\n    var batch = allRequests.slice(i, upTo);\n    processBatch(batch, i);\n    i += batch.length;\n  }\n  function processBatch(batch, offset) {\n    batch.forEach(function (docId, j) {\n      var docIdx = offset + j;\n      var docRequests = requestsById.get(docId);\n\n      // just use the first request as the \"template\"\n      // TODO: The _bulk_get API allows for more subtle use cases than this,\n      // but for now it is unlikely that there will be a mix of different\n      // \"atts_since\" or \"attachments\" in the same request, since it's just\n      // replicate.js that is using this for the moment.\n      // Also, atts_since is aspirational, since we don't support it yet.\n      var docOpts = pick(docRequests[0], ['atts_since', 'attachments']);\n      docOpts.open_revs = docRequests.map(function (request) {\n        // rev is optional, open_revs disallowed\n        return request.rev;\n      });\n\n      // remove falsey / undefined revisions\n      docOpts.open_revs = docOpts.open_revs.filter(identityFunction);\n      var formatResult = identityFunction;\n      if (docOpts.open_revs.length === 0) {\n        delete docOpts.open_revs;\n\n        // when fetching only the \"winning\" leaf,\n        // transform the result so it looks like an open_revs\n        // request\n        formatResult = formatResultForOpenRevsGet;\n      }\n\n      // globally-supplied options\n      ['revs', 'attachments', 'binary', 'ajax', 'latest'].forEach(function (param) {\n        if (param in opts) {\n          docOpts[param] = opts[param];\n        }\n      });\n      db.get(docId, docOpts, function (err, res) {\n        var result;\n        /* istanbul ignore if */\n        if (err) {\n          result = [{\n            error: err\n          }];\n        } else {\n          result = formatResult(res);\n        }\n        gotResult(docIdx, docId, result);\n        nextBatch();\n      });\n    });\n  }\n  nextBatch();\n}\nvar hasLocal;\ntry {\n  localStorage.setItem('_pouch_check_localstorage', 1);\n  hasLocal = !!localStorage.getItem('_pouch_check_localstorage');\n} catch (e) {\n  hasLocal = false;\n}\nfunction hasLocalStorage() {\n  return hasLocal;\n}\n\n// Custom nextTick() shim for browsers. In node, this will just be process.nextTick(). We\n\ninherits(Changes, EventEmitter);\n\n/* istanbul ignore next */\nfunction attachBrowserEvents(self) {\n  if (hasLocalStorage()) {\n    addEventListener(\"storage\", function (e) {\n      self.emit(e.key);\n    });\n  }\n}\nfunction Changes() {\n  EventEmitter.call(this);\n  this._listeners = {};\n  attachBrowserEvents(this);\n}\nChanges.prototype.addListener = function (dbName, id, db, opts) {\n  /* istanbul ignore if */\n  if (this._listeners[id]) {\n    return;\n  }\n  var self = this;\n  var inprogress = false;\n  function eventFunction() {\n    /* istanbul ignore if */\n    if (!self._listeners[id]) {\n      return;\n    }\n    if (inprogress) {\n      inprogress = 'waiting';\n      return;\n    }\n    inprogress = true;\n    var changesOpts = pick(opts, ['style', 'include_docs', 'attachments', 'conflicts', 'filter', 'doc_ids', 'view', 'since', 'query_params', 'binary', 'return_docs']);\n\n    /* istanbul ignore next */\n    function onError() {\n      inprogress = false;\n    }\n    db.changes(changesOpts).on('change', function (c) {\n      if (c.seq > opts.since && !opts.cancelled) {\n        opts.since = c.seq;\n        opts.onChange(c);\n      }\n    }).on('complete', function () {\n      if (inprogress === 'waiting') {\n        immediate(eventFunction);\n      }\n      inprogress = false;\n    }).on('error', onError);\n  }\n  this._listeners[id] = eventFunction;\n  this.on(dbName, eventFunction);\n};\nChanges.prototype.removeListener = function (dbName, id) {\n  /* istanbul ignore if */\n  if (!(id in this._listeners)) {\n    return;\n  }\n  EventEmitter.prototype.removeListener.call(this, dbName, this._listeners[id]);\n  delete this._listeners[id];\n};\n\n/* istanbul ignore next */\nChanges.prototype.notifyLocalWindows = function (dbName) {\n  //do a useless change on a storage thing\n  //in order to get other windows's listeners to activate\n  if (hasLocalStorage()) {\n    localStorage[dbName] = localStorage[dbName] === \"a\" ? \"b\" : \"a\";\n  }\n};\nChanges.prototype.notify = function (dbName) {\n  this.emit(dbName);\n  this.notifyLocalWindows(dbName);\n};\nfunction guardedConsole(method) {\n  /* istanbul ignore else */\n  if (typeof console !== 'undefined' && typeof console[method] === 'function') {\n    var args = Array.prototype.slice.call(arguments, 1);\n    console[method].apply(console, args);\n  }\n}\nfunction randomNumber(min, max) {\n  var maxTimeout = 600000; // Hard-coded default of 10 minutes\n  min = parseInt(min, 10) || 0;\n  max = parseInt(max, 10);\n  if (max !== max || max <= min) {\n    max = (min || 1) << 1; //doubling\n  } else {\n    max = max + 1;\n  }\n  // In order to not exceed maxTimeout, pick a random value between half of maxTimeout and maxTimeout\n  if (max > maxTimeout) {\n    min = maxTimeout >> 1; // divide by two\n    max = maxTimeout;\n  }\n  var ratio = Math.random();\n  var range = max - min;\n  return ~~(range * ratio + min); // ~~ coerces to an int, but fast.\n}\n\nfunction defaultBackOff(min) {\n  var max = 0;\n  if (!min) {\n    max = 2000;\n  }\n  return randomNumber(min, max);\n}\n\n// designed to give info to browser users, who are disturbed\n// when they see http errors in the console\nfunction explainError(status, str) {\n  guardedConsole('info', 'The above ' + status + ' is totally normal. ' + str);\n}\nvar assign$1;\n{\n  if (typeof Object.assign === 'function') {\n    assign$1 = Object.assign;\n  } else {\n    // lite Object.assign polyfill based on\n    // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/assign\n    assign$1 = function (target) {\n      var to = Object(target);\n      for (var index = 1; index < arguments.length; index++) {\n        var nextSource = arguments[index];\n        if (nextSource != null) {\n          // Skip over if undefined or null\n          for (var nextKey in nextSource) {\n            // Avoid bugs when hasOwnProperty is shadowed\n            if (Object.prototype.hasOwnProperty.call(nextSource, nextKey)) {\n              to[nextKey] = nextSource[nextKey];\n            }\n          }\n        }\n      }\n      return to;\n    };\n  }\n}\nvar assign$2 = assign$1;\nfunction tryFilter(filter, doc, req) {\n  try {\n    return !filter(doc, req);\n  } catch (err) {\n    var msg = 'Filter function threw: ' + err.toString();\n    return createError(BAD_REQUEST, msg);\n  }\n}\nfunction filterChange(opts) {\n  var req = {};\n  var hasFilter = opts.filter && typeof opts.filter === 'function';\n  req.query = opts.query_params;\n  return function filter(change) {\n    if (!change.doc) {\n      // CSG sends events on the changes feed that don't have documents,\n      // this hack makes a whole lot of existing code robust.\n      change.doc = {};\n    }\n    var filterReturn = hasFilter && tryFilter(opts.filter, change.doc, req);\n    if (typeof filterReturn === 'object') {\n      return filterReturn;\n    }\n    if (filterReturn) {\n      return false;\n    }\n    if (!opts.include_docs) {\n      delete change.doc;\n    } else if (!opts.attachments) {\n      for (var att in change.doc._attachments) {\n        /* istanbul ignore else */\n        if (Object.prototype.hasOwnProperty.call(change.doc._attachments, att)) {\n          change.doc._attachments[att].stub = true;\n        }\n      }\n    }\n    return true;\n  };\n}\nfunction flatten(arrs) {\n  var res = [];\n  for (var i = 0, len = arrs.length; i < len; i++) {\n    res = res.concat(arrs[i]);\n  }\n  return res;\n}\n\n// shim for Function.prototype.name,\n// for browsers that don't support it like IE\n\n/* istanbul ignore next */\nfunction f() {}\nvar hasName = f.name;\nvar res;\n\n// We dont run coverage in IE\n/* istanbul ignore else */\nif (hasName) {\n  res = function (fun) {\n    return fun.name;\n  };\n} else {\n  res = function (fun) {\n    var match = fun.toString().match(/^\\s*function\\s*(?:(\\S+)\\s*)?\\(/);\n    if (match && match[1]) {\n      return match[1];\n    } else {\n      return '';\n    }\n  };\n}\nvar res$1 = res;\n\n// Determine id an ID is valid\n//   - invalid IDs begin with an underescore that does not begin '_design' or\n//     '_local'\n//   - any other string value is a valid id\n// Returns the specific error object for each case\nfunction invalidIdError(id) {\n  var err;\n  if (!id) {\n    err = createError(MISSING_ID);\n  } else if (typeof id !== 'string') {\n    err = createError(INVALID_ID);\n  } else if (/^_/.test(id) && !/^_(design|local)/.test(id)) {\n    err = createError(RESERVED_ID);\n  }\n  if (err) {\n    throw err;\n  }\n}\n\n// Checks if a PouchDB object is \"remote\" or not. This is\n\nfunction isRemote(db) {\n  if (typeof db._remote === 'boolean') {\n    return db._remote;\n  }\n  /* istanbul ignore next */\n  if (typeof db.type === 'function') {\n    guardedConsole('warn', 'db.type() is deprecated and will be removed in ' + 'a future version of PouchDB');\n    return db.type() === 'http';\n  }\n  /* istanbul ignore next */\n  return false;\n}\nfunction listenerCount(ee, type) {\n  return 'listenerCount' in ee ? ee.listenerCount(type) : EventEmitter.listenerCount(ee, type);\n}\nfunction parseDesignDocFunctionName(s) {\n  if (!s) {\n    return null;\n  }\n  var parts = s.split('/');\n  if (parts.length === 2) {\n    return parts;\n  }\n  if (parts.length === 1) {\n    return [s, s];\n  }\n  return null;\n}\nfunction normalizeDesignDocFunctionName(s) {\n  var normalized = parseDesignDocFunctionName(s);\n  return normalized ? normalized.join('/') : null;\n}\n\n// originally parseUri 1.2.2, now patched by us\n// (c) Steven Levithan <stevenlevithan.com>\n// MIT License\nvar keys = [\"source\", \"protocol\", \"authority\", \"userInfo\", \"user\", \"password\", \"host\", \"port\", \"relative\", \"path\", \"directory\", \"file\", \"query\", \"anchor\"];\nvar qName = \"queryKey\";\nvar qParser = /(?:^|&)([^&=]*)=?([^&]*)/g;\n\n// use the \"loose\" parser\n/* eslint no-useless-escape: 0 */\nvar parser = /^(?:(?![^:@]+:[^:@\\/]*@)([^:\\/?#.]+):)?(?:\\/\\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\\/?#]*)(?::(\\d*))?)(((\\/(?:[^?#](?![^?#\\/]*\\.[^?#\\/.]+(?:[?#]|$)))*\\/?)?([^?#\\/]*))(?:\\?([^#]*))?(?:#(.*))?)/;\nfunction parseUri(str) {\n  var m = parser.exec(str);\n  var uri = {};\n  var i = 14;\n  while (i--) {\n    var key = keys[i];\n    var value = m[i] || \"\";\n    var encoded = ['user', 'password'].indexOf(key) !== -1;\n    uri[key] = encoded ? decodeURIComponent(value) : value;\n  }\n  uri[qName] = {};\n  uri[keys[12]].replace(qParser, function ($0, $1, $2) {\n    if ($1) {\n      uri[qName][$1] = $2;\n    }\n  });\n  return uri;\n}\n\n// Based on https://github.com/alexdavid/scope-eval v0.0.3\n// (source: https://unpkg.com/scope-eval@0.0.3/scope_eval.js)\n// This is basically just a wrapper around new Function()\n\nfunction scopeEval(source, scope) {\n  var keys = [];\n  var values = [];\n  for (var key in scope) {\n    if (Object.prototype.hasOwnProperty.call(scope, key)) {\n      keys.push(key);\n      values.push(scope[key]);\n    }\n  }\n  keys.push(source);\n  return Function.apply(null, keys).apply(null, values);\n}\n\n// this is essentially the \"update sugar\" function from daleharvey/pouchdb#1388\n// the diffFun tells us what delta to apply to the doc.  it either returns\n// the doc, or false if it doesn't need to do an update after all\nfunction upsert(db, docId, diffFun) {\n  return db.get(docId).catch(function (err) {\n    /* istanbul ignore next */\n    if (err.status !== 404) {\n      throw err;\n    }\n    return {};\n  }).then(function (doc) {\n    // the user might change the _rev, so save it for posterity\n    var docRev = doc._rev;\n    var newDoc = diffFun(doc);\n    if (!newDoc) {\n      // if the diffFun returns falsy, we short-circuit as\n      // an optimization\n      return {\n        updated: false,\n        rev: docRev\n      };\n    }\n\n    // users aren't allowed to modify these values,\n    // so reset them here\n    newDoc._id = docId;\n    newDoc._rev = docRev;\n    return tryAndPut(db, newDoc, diffFun);\n  });\n}\nfunction tryAndPut(db, doc, diffFun) {\n  return db.put(doc).then(function (res) {\n    return {\n      updated: true,\n      rev: res.rev\n    };\n  }, function (err) {\n    /* istanbul ignore next */\n    if (err.status !== 409) {\n      throw err;\n    }\n    return upsert(db, doc._id, diffFun);\n  });\n}\n\n/**\n * Creates a new revision string that does NOT include the revision height\n * For example '56649f1b0506c6ca9fda0746eb0cacdf'\n */\nfunction rev(doc, deterministic_revs) {\n  if (!deterministic_revs) {\n    return v4().replace(/-/g, '').toLowerCase();\n  }\n  var mutateableDoc = assign({}, doc);\n  delete mutateableDoc._rev_tree;\n  return stringMd5(JSON.stringify(mutateableDoc));\n}\nvar uuid = v4; // mimic old import, only v4 is ever used elsewhere\n\nexport { adapterFun, assign$2 as assign, bulkGet as bulkGetShim, Changes as changesHandler, clone, defaultBackOff, explainError, filterChange, flatten, res$1 as functionName, guardedConsole, hasLocalStorage, invalidIdError, isRemote, listenerCount, immediate as nextTick, normalizeDesignDocFunctionName as normalizeDdocFunctionName, once, parseDesignDocFunctionName as parseDdocFunctionName, parseUri, pick, rev, scopeEval, toPromise, upsert, uuid };","map":{"version":3,"names":["getArguments","Map","inherits","immediate","createError","BAD_REQUEST","INVALID_ID","MISSING_ID","RESERVED_ID","EventEmitter","assign","v4","stringMd5","isBinaryObject","object","ArrayBuffer","Blob","cloneArrayBuffer","buff","slice","target","byteLength","targetArray","Uint8Array","sourceArray","set","cloneBinaryObject","size","type","webkitSlice","funcToString","Function","prototype","toString","objectCtorString","call","Object","isPlainObject","value","proto","getPrototypeOf","Ctor","constructor","clone","newObject","i","len","Array","isArray","length","Date","isFinite","toISOString","hasOwnProperty","once","fun","called","args","Error","apply","toPromise","func","self","usedCB","pop","promise","Promise","fulfill","reject","resp","callback","err","mesg","push","then","e","result","logApiCall","name","listeners","logArgs","emit","origCallback","res","responseArgs","concat","adapterFun","_closed","_destroyed","taskqueue","isReady","addTask","failed","pick","obj","arr","prop","MAX_NUM_CONCURRENT_REQUESTS","identityFunction","x","formatResultForOpenRevsGet","ok","bulkGet","db","opts","requests","docs","requestsById","forEach","request","has","id","get","numDocs","numDone","perDocResults","collapseResultsAndFinish","results","info","checkDone","gotResult","docIndex","allRequests","key","nextBatch","upTo","Math","min","batch","processBatch","offset","docId","j","docIdx","docRequests","docOpts","open_revs","map","rev","filter","formatResult","param","error","hasLocal","localStorage","setItem","getItem","hasLocalStorage","Changes","attachBrowserEvents","addEventListener","_listeners","addListener","dbName","inprogress","eventFunction","changesOpts","onError","changes","on","c","seq","since","cancelled","onChange","removeListener","notifyLocalWindows","notify","guardedConsole","method","console","arguments","randomNumber","max","maxTimeout","parseInt","ratio","random","range","defaultBackOff","explainError","status","str","assign$1","to","index","nextSource","nextKey","assign$2","tryFilter","doc","req","msg","filterChange","hasFilter","query","query_params","change","filterReturn","include_docs","attachments","att","_attachments","stub","flatten","arrs","f","hasName","match","res$1","invalidIdError","test","isRemote","_remote","listenerCount","ee","parseDesignDocFunctionName","s","parts","split","normalizeDesignDocFunctionName","normalized","join","keys","qName","qParser","parser","parseUri","m","exec","uri","encoded","indexOf","decodeURIComponent","replace","$0","$1","$2","scopeEval","source","scope","values","upsert","diffFun","catch","docRev","_rev","newDoc","updated","_id","tryAndPut","put","deterministic_revs","toLowerCase","mutateableDoc","_rev_tree","JSON","stringify","uuid","bulkGetShim","changesHandler","functionName","nextTick","normalizeDdocFunctionName","parseDdocFunctionName"],"sources":["/home/sol/Documentos/AUS/3ro segundo cuatri/ing 2/URV/node_modules/pouchdb-utils/lib/index-browser.es.js"],"sourcesContent":["import getArguments from 'argsarray';\nimport { Map } from 'pouchdb-collections';\nimport inherits from 'inherits';\nimport immediate from 'immediate';\nimport { createError, BAD_REQUEST, INVALID_ID, MISSING_ID, RESERVED_ID } from 'pouchdb-errors';\nimport EventEmitter from 'events';\nimport { assign } from 'pouchdb-utils';\nimport { v4 } from 'uuid';\nimport { stringMd5 } from 'pouchdb-md5';\n\nfunction isBinaryObject(object) {\n  return (typeof ArrayBuffer !== 'undefined' && object instanceof ArrayBuffer) ||\n    (typeof Blob !== 'undefined' && object instanceof Blob);\n}\n\nfunction cloneArrayBuffer(buff) {\n  if (typeof buff.slice === 'function') {\n    return buff.slice(0);\n  }\n  // IE10-11 slice() polyfill\n  var target = new ArrayBuffer(buff.byteLength);\n  var targetArray = new Uint8Array(target);\n  var sourceArray = new Uint8Array(buff);\n  targetArray.set(sourceArray);\n  return target;\n}\n\nfunction cloneBinaryObject(object) {\n  if (object instanceof ArrayBuffer) {\n    return cloneArrayBuffer(object);\n  }\n  var size = object.size;\n  var type = object.type;\n  // Blob\n  if (typeof object.slice === 'function') {\n    return object.slice(0, size, type);\n  }\n  // PhantomJS slice() replacement\n  return object.webkitSlice(0, size, type);\n}\n\n// most of this is borrowed from lodash.isPlainObject:\n// https://github.com/fis-components/lodash.isplainobject/\n// blob/29c358140a74f252aeb08c9eb28bef86f2217d4a/index.js\n\nvar funcToString = Function.prototype.toString;\nvar objectCtorString = funcToString.call(Object);\n\nfunction isPlainObject(value) {\n  var proto = Object.getPrototypeOf(value);\n  /* istanbul ignore if */\n  if (proto === null) { // not sure when this happens, but I guess it can\n    return true;\n  }\n  var Ctor = proto.constructor;\n  return (typeof Ctor == 'function' &&\n    Ctor instanceof Ctor && funcToString.call(Ctor) == objectCtorString);\n}\n\nfunction clone(object) {\n  var newObject;\n  var i;\n  var len;\n\n  if (!object || typeof object !== 'object') {\n    return object;\n  }\n\n  if (Array.isArray(object)) {\n    newObject = [];\n    for (i = 0, len = object.length; i < len; i++) {\n      newObject[i] = clone(object[i]);\n    }\n    return newObject;\n  }\n\n  // special case: to avoid inconsistencies between IndexedDB\n  // and other backends, we automatically stringify Dates\n  if (object instanceof Date && isFinite(object)) {\n    return object.toISOString();\n  }\n\n  if (isBinaryObject(object)) {\n    return cloneBinaryObject(object);\n  }\n\n  if (!isPlainObject(object)) {\n    return object; // don't clone objects like Workers\n  }\n\n  newObject = {};\n  for (i in object) {\n    /* istanbul ignore else */\n    if (Object.prototype.hasOwnProperty.call(object, i)) {\n      var value = clone(object[i]);\n      if (typeof value !== 'undefined') {\n        newObject[i] = value;\n      }\n    }\n  }\n  return newObject;\n}\n\nfunction once(fun) {\n  var called = false;\n  return getArguments(function (args) {\n    /* istanbul ignore if */\n    if (called) {\n      // this is a smoke test and should never actually happen\n      throw new Error('once called more than once');\n    } else {\n      called = true;\n      fun.apply(this, args);\n    }\n  });\n}\n\nfunction toPromise(func) {\n  //create the function we will be returning\n  return getArguments(function (args) {\n    // Clone arguments\n    args = clone(args);\n    var self = this;\n    // if the last argument is a function, assume its a callback\n    var usedCB = (typeof args[args.length - 1] === 'function') ? args.pop() : false;\n    var promise = new Promise(function (fulfill, reject) {\n      var resp;\n      try {\n        var callback = once(function (err, mesg) {\n          if (err) {\n            reject(err);\n          } else {\n            fulfill(mesg);\n          }\n        });\n        // create a callback for this invocation\n        // apply the function in the orig context\n        args.push(callback);\n        resp = func.apply(self, args);\n        if (resp && typeof resp.then === 'function') {\n          fulfill(resp);\n        }\n      } catch (e) {\n        reject(e);\n      }\n    });\n    // if there is a callback, call it back\n    if (usedCB) {\n      promise.then(function (result) {\n        usedCB(null, result);\n      }, usedCB);\n    }\n    return promise;\n  });\n}\n\nfunction logApiCall(self, name, args) {\n  /* istanbul ignore if */\n  if (self.constructor.listeners('debug').length) {\n    var logArgs = ['api', self.name, name];\n    for (var i = 0; i < args.length - 1; i++) {\n      logArgs.push(args[i]);\n    }\n    self.constructor.emit('debug', logArgs);\n\n    // override the callback itself to log the response\n    var origCallback = args[args.length - 1];\n    args[args.length - 1] = function (err, res) {\n      var responseArgs = ['api', self.name, name];\n      responseArgs = responseArgs.concat(\n        err ? ['error', err] : ['success', res]\n      );\n      self.constructor.emit('debug', responseArgs);\n      origCallback(err, res);\n    };\n  }\n}\n\nfunction adapterFun(name, callback) {\n  return toPromise(getArguments(function (args) {\n    if (this._closed) {\n      return Promise.reject(new Error('database is closed'));\n    }\n    if (this._destroyed) {\n      return Promise.reject(new Error('database is destroyed'));\n    }\n    var self = this;\n    logApiCall(self, name, args);\n    if (!this.taskqueue.isReady) {\n      return new Promise(function (fulfill, reject) {\n        self.taskqueue.addTask(function (failed) {\n          if (failed) {\n            reject(failed);\n          } else {\n            fulfill(self[name].apply(self, args));\n          }\n        });\n      });\n    }\n    return callback.apply(this, args);\n  }));\n}\n\n// like underscore/lodash _.pick()\nfunction pick(obj, arr) {\n  var res = {};\n  for (var i = 0, len = arr.length; i < len; i++) {\n    var prop = arr[i];\n    if (prop in obj) {\n      res[prop] = obj[prop];\n    }\n  }\n  return res;\n}\n\n// Most browsers throttle concurrent requests at 6, so it's silly\n// to shim _bulk_get by trying to launch potentially hundreds of requests\n// and then letting the majority time out. We can handle this ourselves.\nvar MAX_NUM_CONCURRENT_REQUESTS = 6;\n\nfunction identityFunction(x) {\n  return x;\n}\n\nfunction formatResultForOpenRevsGet(result) {\n  return [{\n    ok: result\n  }];\n}\n\n// shim for P/CouchDB adapters that don't directly implement _bulk_get\nfunction bulkGet(db, opts, callback) {\n  var requests = opts.docs;\n\n  // consolidate into one request per doc if possible\n  var requestsById = new Map();\n  requests.forEach(function (request) {\n    if (requestsById.has(request.id)) {\n      requestsById.get(request.id).push(request);\n    } else {\n      requestsById.set(request.id, [request]);\n    }\n  });\n\n  var numDocs = requestsById.size;\n  var numDone = 0;\n  var perDocResults = new Array(numDocs);\n\n  function collapseResultsAndFinish() {\n    var results = [];\n    perDocResults.forEach(function (res) {\n      res.docs.forEach(function (info) {\n        results.push({\n          id: res.id,\n          docs: [info]\n        });\n      });\n    });\n    callback(null, {results: results});\n  }\n\n  function checkDone() {\n    if (++numDone === numDocs) {\n      collapseResultsAndFinish();\n    }\n  }\n\n  function gotResult(docIndex, id, docs) {\n    perDocResults[docIndex] = {id: id, docs: docs};\n    checkDone();\n  }\n\n  var allRequests = [];\n  requestsById.forEach(function (value, key) {\n    allRequests.push(key);\n  });\n\n  var i = 0;\n\n  function nextBatch() {\n\n    if (i >= allRequests.length) {\n      return;\n    }\n\n    var upTo = Math.min(i + MAX_NUM_CONCURRENT_REQUESTS, allRequests.length);\n    var batch = allRequests.slice(i, upTo);\n    processBatch(batch, i);\n    i += batch.length;\n  }\n\n  function processBatch(batch, offset) {\n    batch.forEach(function (docId, j) {\n      var docIdx = offset + j;\n      var docRequests = requestsById.get(docId);\n\n      // just use the first request as the \"template\"\n      // TODO: The _bulk_get API allows for more subtle use cases than this,\n      // but for now it is unlikely that there will be a mix of different\n      // \"atts_since\" or \"attachments\" in the same request, since it's just\n      // replicate.js that is using this for the moment.\n      // Also, atts_since is aspirational, since we don't support it yet.\n      var docOpts = pick(docRequests[0], ['atts_since', 'attachments']);\n      docOpts.open_revs = docRequests.map(function (request) {\n        // rev is optional, open_revs disallowed\n        return request.rev;\n      });\n\n      // remove falsey / undefined revisions\n      docOpts.open_revs = docOpts.open_revs.filter(identityFunction);\n\n      var formatResult = identityFunction;\n\n      if (docOpts.open_revs.length === 0) {\n        delete docOpts.open_revs;\n\n        // when fetching only the \"winning\" leaf,\n        // transform the result so it looks like an open_revs\n        // request\n        formatResult = formatResultForOpenRevsGet;\n      }\n\n      // globally-supplied options\n      ['revs', 'attachments', 'binary', 'ajax', 'latest'].forEach(function (param) {\n        if (param in opts) {\n          docOpts[param] = opts[param];\n        }\n      });\n      db.get(docId, docOpts, function (err, res) {\n        var result;\n        /* istanbul ignore if */\n        if (err) {\n          result = [{error: err}];\n        } else {\n          result = formatResult(res);\n        }\n        gotResult(docIdx, docId, result);\n        nextBatch();\n      });\n    });\n  }\n\n  nextBatch();\n\n}\n\nvar hasLocal;\n\ntry {\n  localStorage.setItem('_pouch_check_localstorage', 1);\n  hasLocal = !!localStorage.getItem('_pouch_check_localstorage');\n} catch (e) {\n  hasLocal = false;\n}\n\nfunction hasLocalStorage() {\n  return hasLocal;\n}\n\n// Custom nextTick() shim for browsers. In node, this will just be process.nextTick(). We\n\ninherits(Changes, EventEmitter);\n\n/* istanbul ignore next */\nfunction attachBrowserEvents(self) {\n  if (hasLocalStorage()) {\n    addEventListener(\"storage\", function (e) {\n      self.emit(e.key);\n    });\n  }\n}\n\nfunction Changes() {\n  EventEmitter.call(this);\n  this._listeners = {};\n\n  attachBrowserEvents(this);\n}\nChanges.prototype.addListener = function (dbName, id, db, opts) {\n  /* istanbul ignore if */\n  if (this._listeners[id]) {\n    return;\n  }\n  var self = this;\n  var inprogress = false;\n  function eventFunction() {\n    /* istanbul ignore if */\n    if (!self._listeners[id]) {\n      return;\n    }\n    if (inprogress) {\n      inprogress = 'waiting';\n      return;\n    }\n    inprogress = true;\n    var changesOpts = pick(opts, [\n      'style', 'include_docs', 'attachments', 'conflicts', 'filter',\n      'doc_ids', 'view', 'since', 'query_params', 'binary', 'return_docs'\n    ]);\n\n    /* istanbul ignore next */\n    function onError() {\n      inprogress = false;\n    }\n\n    db.changes(changesOpts).on('change', function (c) {\n      if (c.seq > opts.since && !opts.cancelled) {\n        opts.since = c.seq;\n        opts.onChange(c);\n      }\n    }).on('complete', function () {\n      if (inprogress === 'waiting') {\n        immediate(eventFunction);\n      }\n      inprogress = false;\n    }).on('error', onError);\n  }\n  this._listeners[id] = eventFunction;\n  this.on(dbName, eventFunction);\n};\n\nChanges.prototype.removeListener = function (dbName, id) {\n  /* istanbul ignore if */\n  if (!(id in this._listeners)) {\n    return;\n  }\n  EventEmitter.prototype.removeListener.call(this, dbName,\n    this._listeners[id]);\n  delete this._listeners[id];\n};\n\n\n/* istanbul ignore next */\nChanges.prototype.notifyLocalWindows = function (dbName) {\n  //do a useless change on a storage thing\n  //in order to get other windows's listeners to activate\n  if (hasLocalStorage()) {\n    localStorage[dbName] = (localStorage[dbName] === \"a\") ? \"b\" : \"a\";\n  }\n};\n\nChanges.prototype.notify = function (dbName) {\n  this.emit(dbName);\n  this.notifyLocalWindows(dbName);\n};\n\nfunction guardedConsole(method) {\n  /* istanbul ignore else */\n  if (typeof console !== 'undefined' && typeof console[method] === 'function') {\n    var args = Array.prototype.slice.call(arguments, 1);\n    console[method].apply(console, args);\n  }\n}\n\nfunction randomNumber(min, max) {\n  var maxTimeout = 600000; // Hard-coded default of 10 minutes\n  min = parseInt(min, 10) || 0;\n  max = parseInt(max, 10);\n  if (max !== max || max <= min) {\n    max = (min || 1) << 1; //doubling\n  } else {\n    max = max + 1;\n  }\n  // In order to not exceed maxTimeout, pick a random value between half of maxTimeout and maxTimeout\n  if (max > maxTimeout) {\n    min = maxTimeout >> 1; // divide by two\n    max = maxTimeout;\n  }\n  var ratio = Math.random();\n  var range = max - min;\n\n  return ~~(range * ratio + min); // ~~ coerces to an int, but fast.\n}\n\nfunction defaultBackOff(min) {\n  var max = 0;\n  if (!min) {\n    max = 2000;\n  }\n  return randomNumber(min, max);\n}\n\n// designed to give info to browser users, who are disturbed\n// when they see http errors in the console\nfunction explainError(status, str) {\n  guardedConsole('info', 'The above ' + status + ' is totally normal. ' + str);\n}\n\nvar assign$1;\n{\n  if (typeof Object.assign === 'function') {\n    assign$1 = Object.assign;\n  } else {\n    // lite Object.assign polyfill based on\n    // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/assign\n    assign$1 = function (target) {\n      var to = Object(target);\n\n      for (var index = 1; index < arguments.length; index++) {\n        var nextSource = arguments[index];\n\n        if (nextSource != null) { // Skip over if undefined or null\n          for (var nextKey in nextSource) {\n            // Avoid bugs when hasOwnProperty is shadowed\n            if (Object.prototype.hasOwnProperty.call(nextSource, nextKey)) {\n              to[nextKey] = nextSource[nextKey];\n            }\n          }\n        }\n      }\n      return to;\n    };\n  }\n}\n\nvar assign$2 = assign$1;\n\nfunction tryFilter(filter, doc, req) {\n  try {\n    return !filter(doc, req);\n  } catch (err) {\n    var msg = 'Filter function threw: ' + err.toString();\n    return createError(BAD_REQUEST, msg);\n  }\n}\n\nfunction filterChange(opts) {\n  var req = {};\n  var hasFilter = opts.filter && typeof opts.filter === 'function';\n  req.query = opts.query_params;\n\n  return function filter(change) {\n    if (!change.doc) {\n      // CSG sends events on the changes feed that don't have documents,\n      // this hack makes a whole lot of existing code robust.\n      change.doc = {};\n    }\n\n    var filterReturn = hasFilter && tryFilter(opts.filter, change.doc, req);\n\n    if (typeof filterReturn === 'object') {\n      return filterReturn;\n    }\n\n    if (filterReturn) {\n      return false;\n    }\n\n    if (!opts.include_docs) {\n      delete change.doc;\n    } else if (!opts.attachments) {\n      for (var att in change.doc._attachments) {\n        /* istanbul ignore else */\n        if (Object.prototype.hasOwnProperty.call(change.doc._attachments, att)) {\n          change.doc._attachments[att].stub = true;\n        }\n      }\n    }\n    return true;\n  };\n}\n\nfunction flatten(arrs) {\n  var res = [];\n  for (var i = 0, len = arrs.length; i < len; i++) {\n    res = res.concat(arrs[i]);\n  }\n  return res;\n}\n\n// shim for Function.prototype.name,\n// for browsers that don't support it like IE\n\n/* istanbul ignore next */\nfunction f() {}\n\nvar hasName = f.name;\nvar res;\n\n// We dont run coverage in IE\n/* istanbul ignore else */\nif (hasName) {\n  res = function (fun) {\n    return fun.name;\n  };\n} else {\n  res = function (fun) {\n    var match = fun.toString().match(/^\\s*function\\s*(?:(\\S+)\\s*)?\\(/);\n    if (match && match[1]) {\n      return match[1];\n    }\n    else {\n      return '';\n    }\n  };\n}\n\nvar res$1 = res;\n\n// Determine id an ID is valid\n//   - invalid IDs begin with an underescore that does not begin '_design' or\n//     '_local'\n//   - any other string value is a valid id\n// Returns the specific error object for each case\nfunction invalidIdError(id) {\n  var err;\n  if (!id) {\n    err = createError(MISSING_ID);\n  } else if (typeof id !== 'string') {\n    err = createError(INVALID_ID);\n  } else if (/^_/.test(id) && !(/^_(design|local)/).test(id)) {\n    err = createError(RESERVED_ID);\n  }\n  if (err) {\n    throw err;\n  }\n}\n\n// Checks if a PouchDB object is \"remote\" or not. This is\n\nfunction isRemote(db) {\n  if (typeof db._remote === 'boolean') {\n    return db._remote;\n  }\n  /* istanbul ignore next */\n  if (typeof db.type === 'function') {\n    guardedConsole('warn',\n      'db.type() is deprecated and will be removed in ' +\n      'a future version of PouchDB');\n    return db.type() === 'http';\n  }\n  /* istanbul ignore next */\n  return false;\n}\n\nfunction listenerCount(ee, type) {\n  return 'listenerCount' in ee ? ee.listenerCount(type) :\n                                 EventEmitter.listenerCount(ee, type);\n}\n\nfunction parseDesignDocFunctionName(s) {\n  if (!s) {\n    return null;\n  }\n  var parts = s.split('/');\n  if (parts.length === 2) {\n    return parts;\n  }\n  if (parts.length === 1) {\n    return [s, s];\n  }\n  return null;\n}\n\nfunction normalizeDesignDocFunctionName(s) {\n  var normalized = parseDesignDocFunctionName(s);\n  return normalized ? normalized.join('/') : null;\n}\n\n// originally parseUri 1.2.2, now patched by us\n// (c) Steven Levithan <stevenlevithan.com>\n// MIT License\nvar keys = [\"source\", \"protocol\", \"authority\", \"userInfo\", \"user\", \"password\",\n    \"host\", \"port\", \"relative\", \"path\", \"directory\", \"file\", \"query\", \"anchor\"];\nvar qName =\"queryKey\";\nvar qParser = /(?:^|&)([^&=]*)=?([^&]*)/g;\n\n// use the \"loose\" parser\n/* eslint no-useless-escape: 0 */\nvar parser = /^(?:(?![^:@]+:[^:@\\/]*@)([^:\\/?#.]+):)?(?:\\/\\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\\/?#]*)(?::(\\d*))?)(((\\/(?:[^?#](?![^?#\\/]*\\.[^?#\\/.]+(?:[?#]|$)))*\\/?)?([^?#\\/]*))(?:\\?([^#]*))?(?:#(.*))?)/;\n\nfunction parseUri(str) {\n  var m = parser.exec(str);\n  var uri = {};\n  var i = 14;\n\n  while (i--) {\n    var key = keys[i];\n    var value = m[i] || \"\";\n    var encoded = ['user', 'password'].indexOf(key) !== -1;\n    uri[key] = encoded ? decodeURIComponent(value) : value;\n  }\n\n  uri[qName] = {};\n  uri[keys[12]].replace(qParser, function ($0, $1, $2) {\n    if ($1) {\n      uri[qName][$1] = $2;\n    }\n  });\n\n  return uri;\n}\n\n// Based on https://github.com/alexdavid/scope-eval v0.0.3\n// (source: https://unpkg.com/scope-eval@0.0.3/scope_eval.js)\n// This is basically just a wrapper around new Function()\n\nfunction scopeEval(source, scope) {\n  var keys = [];\n  var values = [];\n  for (var key in scope) {\n    if (Object.prototype.hasOwnProperty.call(scope, key)) {\n      keys.push(key);\n      values.push(scope[key]);\n    }\n  }\n  keys.push(source);\n  return Function.apply(null, keys).apply(null, values);\n}\n\n// this is essentially the \"update sugar\" function from daleharvey/pouchdb#1388\n// the diffFun tells us what delta to apply to the doc.  it either returns\n// the doc, or false if it doesn't need to do an update after all\nfunction upsert(db, docId, diffFun) {\n  return db.get(docId)\n    .catch(function (err) {\n      /* istanbul ignore next */\n      if (err.status !== 404) {\n        throw err;\n      }\n      return {};\n    })\n    .then(function (doc) {\n      // the user might change the _rev, so save it for posterity\n      var docRev = doc._rev;\n      var newDoc = diffFun(doc);\n\n      if (!newDoc) {\n        // if the diffFun returns falsy, we short-circuit as\n        // an optimization\n        return {updated: false, rev: docRev};\n      }\n\n      // users aren't allowed to modify these values,\n      // so reset them here\n      newDoc._id = docId;\n      newDoc._rev = docRev;\n      return tryAndPut(db, newDoc, diffFun);\n    });\n}\n\nfunction tryAndPut(db, doc, diffFun) {\n  return db.put(doc).then(function (res) {\n    return {\n      updated: true,\n      rev: res.rev\n    };\n  }, function (err) {\n    /* istanbul ignore next */\n    if (err.status !== 409) {\n      throw err;\n    }\n    return upsert(db, doc._id, diffFun);\n  });\n}\n\n/**\n * Creates a new revision string that does NOT include the revision height\n * For example '56649f1b0506c6ca9fda0746eb0cacdf'\n */\nfunction rev(doc, deterministic_revs) {\n  if (!deterministic_revs) {\n    return v4().replace(/-/g, '').toLowerCase();\n  }\n\n  var mutateableDoc = assign({}, doc);\n  delete mutateableDoc._rev_tree;\n  return stringMd5(JSON.stringify(mutateableDoc));\n}\n\nvar uuid = v4; // mimic old import, only v4 is ever used elsewhere\n\nexport { adapterFun, assign$2 as assign, bulkGet as bulkGetShim, Changes as changesHandler, clone, defaultBackOff, explainError, filterChange, flatten, res$1 as functionName, guardedConsole, hasLocalStorage, invalidIdError, isRemote, listenerCount, immediate as nextTick, normalizeDesignDocFunctionName as normalizeDdocFunctionName, once, parseDesignDocFunctionName as parseDdocFunctionName, parseUri, pick, rev, scopeEval, toPromise, upsert, uuid };\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}